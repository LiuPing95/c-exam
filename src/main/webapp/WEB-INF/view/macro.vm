#macro(msgDlg)
	<div class="am-modal am-modal-confirm" tabindex="-1" id="my-confirm">
		<div class="am-modal-dialog">
			<div class="am-modal-hd" id="msgHead"></div>
				<div class="am-modal-bd" id="showMessage"></div>
			<div class="am-modal-footer">
				<span class="am-modal-btn" data-am-modal-confirm>确定</span>
			</div>
		</div>
	</div>
	<script>
		function open(head, msg, url){
			$("#msgHead").text(head);
	  		$("#showMessage").text(msg);
	  		$('#my-confirm').modal({
	       		relatedTarget: this,
	       		onConfirm: function(options) {
		        	window.location.href=url;
		        },
		        onCancel: function() {
		          	
		        }
	      	});
  		}
	</script>
#end

#macro(page)
	<input type="hidden" name="pageNum" id="pageNum" value="#if($!{page.size} == 0) $!{page.defaultPageNum} #else $!{page.pageNum} #end" />
	##判断当页是否有数据
	#if($!{page} && $!{page.size} > 0 && ($!{page.pageNum} != $!{page.defaultPageNum} || $!{page.size} == $!{page.pageSize}))
	  ##设置js函数
	  <script>
	    function next() {
		  var pn = document.getElementById("pageNum").value;
		  document.getElementById("pageNum").value = Number(pn) + 1;
		  document.getElementById("pageForm").submit();
	    }
	    function prev() {
		  var pn = document.getElementById("pageNum").value;
		  document.getElementById("pageNum").value = Number(pn) - 1;
		  document.getElementById("pageForm").submit();
		}
	    function selectPageNum() {
		  document.getElementById("pageNum").value = document.getElementById("pageSelect").value;
		  document.getElementById("pageForm").submit();
		}
	  </script>
	  ##显示上页、下页跳转链接
	  <div class="am-cf">
	    <div class="am-fr">
	      <ul data-am-widget="pagination" class="am-pagination am-pagination-default">
	        #if($!{page.pageNum} > $!{page.defaultPageNum})
	          <li class="am-pagination-prev"><a href="javascript:prev()">上页</a></li>
	        #end
	        #if($!{page.totalPage} > 1)
	          <li class="am-pagination-select">
	            <div class="am-dropdown am-dropdown-up" data-am-dropdown>
	              <select data-am-selected="{dropUp: 1, searchBox: 1, maxHeight: 160, btnWidth: 80, btnSize: 'sm'}" id="pageSelect" onchange="selectPageNum()">
	                 #foreach($!{pageIndex} in [1 .. $!{page.totalPage}])
    			      <option value="$!{pageIndex}" #if($!{page.pageNum}==$!{pageIndex}) selected #end>第$!{pageIndex}页</option>
	                 #end
	              </select>
	              #*1.页数过多，仅能显示部分页码；2.右侧没有滚动条，无法选择页码
	              <button class="am-btn am-btn-success am-dropdown-toggle am-btn-xs" data-am-dropdown-toggle>第$!{page.pageNum}页&nbsp;&nbsp</button>
  				  <ul class="am-dropdown-content">
  				    #foreach($!{pageIndex} in [1 .. $!{page.totalPage}])
    			      <li><a href="javascript:selectPageNum($pageIndex)">第$!{pageIndex}页</a></li>
	                #end
  				  </ul>
  				  *#
			    </div>
	          </li>
	        #end
	        
	        #if($!{page.totalSize} > 0)
		        #if($!{page.pageNum} < $!{page.totalPage})
		          <li class="am-pagination-next"><a href="javascript:next()">下页</a></li>
		        #end
		    #else
		        #if($!{page.size} == $!{page.pageSize})
		          <li class="am-pagination-next"><a href="javascript:next()">下页</a></li>
		        #end
		     #end
	      </ul>
	    </div>
	  </div>
	##兼容性代码：修复最后一页刚好等于页面记录数时，不显示上一页的BUG
	#elseif($!{page.size} == 0 && $!{page.pageNum} != $!{page.defaultPageNum})
	  <script>
	    function prev() {
		  var pn = $!{page.pageNum};//兼容性代码：修复最后一页刚好等于页面记录数时，将页号设置为0的BUG
		  document.getElementById("pageNum").value = Number(pn) - 1;
		  document.getElementById("pageForm").submit();
		}
	  </script>
	  <div class="am-cf">
	    <div class="am-fr">
	      <ul data-am-widget="pagination" class="am-pagination am-pagination-default">
	        <li class="am-pagination-prev"><a href="javascript:prev()">上页</a></li>
	      </ul>
	    </div>
	  </div>
	#end	  
#end

#macro(head)
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>学生管理系统</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <meta name='renderer' content='webkit'><meta http-equiv='Cache-Control' content='no-siteapp' />
  <link rel='icon' type='image/png' href='$!{rc.contextPath}/static/assets/i/favicon.png'>
  <link rel='apple-touch-icon-precomposed' href='$!{rc.contextPath}/start-console-web/static/assets/i/app-icon72x72@2x.png'>
  <link rel='stylesheet' href='$!{rc.contextPath}/static/assets/css/amazeui.min.css'/>
  <link rel='stylesheet' href='$!{rc.contextPath}/static/assets/css/admin.css'>
  <link rel='stylesheet' href='$!{rc.contextPath}/static/assets/css/app.css'>
  <script src="$!{rc.contextPath}/static/jquery-1.11.3.js"></script>
#end

#macro(top)
  <!--[if lte IE 9]>
    <p class="browsehappy">你正在使用<strong>过时</strong>的浏览器，Amaze UI 暂不支持。 请升级浏览器</a>以获得更好的体验！</p>
  <![endif]-->
  <header class="am-topbar admin-header">
    <div class="am-topbar-brand">
      <strong>$!{dingsns.mainTitle}</strong> <small>$!{dingsns.subTitle}</small>
    </div>
    <button class="am-topbar-btn am-topbar-toggle am-btn am-btn-sm am-btn-success am-show-sm-only" data-am-collapse="{target: '#topbar-collapse'}">
      <span class="am-sr-only">导航切换</span>
      <span class="am-icon-bars"></span>
    </button>
    <div class="am-collapse am-topbar-collapse" id="topbar-collapse">
      <ul class="am-nav am-nav-pills am-topbar-nav am-topbar-right admin-header-list">
        <li class="am-dropdown" data-am-dropdown><a href="javascript:;">$!{dingsns.user.role.name}</a></li>
        <li class="am-dropdown" data-am-dropdown><a class="am-dropdown-toggle" data-am-dropdown-toggle href="javascript:;">$!{dingsns.user.name}</a></li>
        <li class="am-dropdown" data-am-dropdown><a href="$!{rc.contextPath}/logout" title="注销"><span class="am-icon-sign-out"></span></a></li>
      </ul>
    </div>
  </header>
#end

#macro(crumb)
  #set($auth_ = $!{dingsns.getAuth($!{request})})
  #if($!{auth_})
    <ol class="am-breadcrumb"><li>$!{auth_.module.name}</li><li class="am-active">$!{auth_.name}</li></ol>
  #end
  #if($!{exceptionMsg})
    <div class="am-panel-group" id="accordion">
      <div class="am-panel am-panel-danger">
        <div class="am-panel-hd">
          <h4 class="am-panel-title" data-am-collapse="{parent: '#accordion', target: '#do-not-say-1'}">&nbsp;&nbsp;服务器运行异常</h4>
        </div>
        <div id="do-not-say-1" class="am-panel-collapse am-collapse">
          <div class="am-panel-bd">
            <pre>$!{exceptionMsg}</pre>
          </div>
        </div>
      </div>
    </div>
  #end
#end

#macro(menu)
  #set($uri_ = $!{dingsns.reqUri($request)})
  <div class='admin-sidebar am-offcanvas' id='admin-offcanvas'>
    <div class='am-offcanvas-bar admin-offcanvas-bar'>
      <ul class='am-list admin-sidebar-list'>
        <li><a href='$!{rc.contextPath}/index'>首页</a></li>
        #set($moduleList_ = $!{dingsns.moduleList($!{dingsns.user})})
        #foreach($module in $!{moduleList_})
          <li class='admin-parent'>
            <a class='am-cf' data-am-collapse="{target:'#$!{module.id}'}">$!{module.name}<span class='am-icon-angle-right am-fr am-margin-right'></span></a>
            <ul class='am-list am-collapse admin-sidebar-sub#if($!{dingsns.containSubStr($!{module.authList},$!{uri_})}) am-in#end' id='$!{module.id}'>
            #foreach($auth in $!{module.authList})
              #if($!{auth} && $!{auth.isMenu} == 0)
                <li><a href='$!{rc.contextPath}$!{auth.url}'>$!{auth.name}</a></li>
              #end
            #end
            </ul>
          </li>
        #end
      </ul>
      <div class='am-panel am-panel-default admin-sidebar-panel'>
        <div class='am-panel-bd'><p><span class="am-icon-bookmark"></span> 公告</p></div>
      </div>
    </div>
  </div>
#end

#macro(errorMsg)
  #if($!{msg})
    <div class="am-modal am-modal-alert" tabindex="-1" id="my-alert">
      <div class="am-modal-dialog">
        <div class="am-modal-bd">$!{msg}</div>
        <div class="am-modal-footer"><span class="am-modal-btn">确定</span></div>
      </div>
    </div>
    <script>$('#my-alert').modal('open');</script>
  #end
#end

#macro(pageJs)
  <script>
    function pageSubmit() {
	  document.getElementById("pageNum").value=1;
	  document.getElementById("pageForm").submit();
	}
  </script>
#end

#macro(smMenu)
  <a href='#' class='am-show-sm-only admin-menu' data-am-offcanvas="{target: '#admin-offcanvas'}">
    <span class='am-icon-btn am-icon-th-list'></span>
  </a>
#end

#macro(amazeuiJs)
  <script src='$!{rc.contextPath}/static/assets/js/amazeui.min.js'></script>
  <script src='$!{rc.contextPath}/static/assets/js/app.js'></script>
#end

#macro(linkConfig)
    <div class="am-g">
        <div class="am-u-sm-2">
            <select class="am-input-sm" id="macroLinkConfigSelect">
                <option value="0">默认</option>
                <option value="1">直播间</option>
                <option value="2">个人空间</option>
                <option value="3">推荐页</option>
                <option value="4">动态详情</option>
            </select>
        </div>
        <div class="am-u-sm-10">
            <label id="macroLinkConfigNotice" style="font-size: 12px;color: red"></label>
        </div>
    </div>
#end

#macro(linkConfigJS $id $his) <!-- id:赋值空间ID;his:历史数据 -->
    <input type="hidden" id="macroLinkConfigHis" value="$his">
    <script>
        <!--  -->
        var macroLinkConfigHref = {};
        var macroLinkConfigDesc = {};
        macroLinkConfigHref[1] = "xtlive://xtlive/live?id=[XXX]&tag=[XXX]";
        macroLinkConfigDesc[1] = "替换[XXX] tag:0 或者没有时 id表示用户id;tag:1 id表示直播间id";
        macroLinkConfigHref[2] = "xtlive://xtlive/userspace?id=[XXX]";
        macroLinkConfigDesc[2] = "替换 [XXX] 为用户ID";
        macroLinkConfigHref[3] = "xtlive://xtlive/home?id=[XXX]";
        macroLinkConfigDesc[3] = "替换 [XXX] 为0:推荐 或者 1:发现";
        macroLinkConfigHref[4] = "xtlive://xtlive/dynamicdetail?id=[XXX]&mediaType=[XXX]";
        macroLinkConfigDesc[4] = "替换 [XXX] id:动态id;mediaType:动态类型 LIVE、VIDEO、PIC_TXT、TOPIC";
        $("#macroLinkConfigSelect").change(function () {
            if($("#macroLinkConfigSelect").val() == "0"){
                $("#$id").val($("#macroLinkConfigHis").val());
                $("#macroLinkConfigNotice").html("");
            }else{
                $("#$id").val(macroLinkConfigHref[$("#macroLinkConfigSelect").val()]);
                $("#macroLinkConfigNotice").html(macroLinkConfigDesc[$("#macroLinkConfigSelect").val()]);
            }
        });
        $("#$id").blur(function () {
            var hrefVal = $("#$id").val();
            if(hrefVal.indexOf("http") == 0){<!-- 编码 -->
                $("#$id").val(decodeURIComponent(hrefVal));
            }
            if(hrefVal.indexOf("xtlive://xtlive/web?url=") == 0){<!-- 编码 -->
                hrefVal = hrefVal.replace("xtlive://xtlive/web?url=","");
                hrefVal = encodeURIComponent(decodeURIComponent(hrefVal));
                $("#$id").val("xtlive://xtlive/web?url="+hrefVal);
            }
        });
    </script>
#end

#macro(student)
<form action="" method="post" id="pageForm" style="width:100%">
  <div class="admin-content-body">
  <div class="am-cf am-padding">
    <div class="am-fl am-cf"><strong class="am-text-primary am-text-lg">Student Infomatino</strong></div>
  </div>
  <input class="am-btn am-btn-primary" value="Add Student" onclick="window.location.href='$!{rc.contextPath}/stu/toAdd?action=add'"/>
  <div class="am-g">
  <br />
    <div class="am-u-sm-12 am-u-md-3">
        <input type="text" name="stuName" class="am-form-field" placeholder="StudentName">
    </div>
    <div class="am-u-sm-12 am-u-md-3">
        <input type="text" name="className" class="am-form-field" placeholder="ClassName">
    </div>
    <div class="am-u-sm-12 am-u-md-3">
        <input type="text" name="deptName" class="am-form-field" placeholder="DeptName">
    </div>
    <span class="am-input-group-btn"><button class="am-btn am-btn-default" onclick="pageSubmit()">搜索</button></span>
    <div class="am-u-sm-12">
      <table class="am-table am-table-bd am-table-striped admin-content-table">
        <thead>
        <tr>
          <th>StudentId</th><th>Name</th><th>Address</th><th>Dormitory</th><th>Gender</th><th>Age</th><th>Birthday</th><th>Class</th><th>Dept</th><th>Option</th>
        </tr>
        </thead>
        <tbody>
        #foreach($stu in $!{student.data})
            <tr>
        	  <td>$!{stu.stuId}</td>
        	  <td>$!{stu.stuName}</td>
        	  <td>$!{stu.addr}</td>
        	  <td>$!{stu.dormitory}</td>
        	  <td>$!{stu.gender}</td>
        	  <td>$!{stu.age}</td>
        	  <td>$!{stu.birth}</td>
        	  <td>$!{stu.className}</td>
        	  <td>$!{stu.deptName}</td>
              <td>
                <div class="am-dropdown" data-am-dropdown>
                  <button class="am-btn am-btn-default am-btn-xs am-dropdown-toggle" data-am-dropdown-toggle><span class="am-icon-cog"></span> <span class="am-icon-caret-down"></span></button>
                  <ul class="am-dropdown-content">
                    <li><a href="javascript:window.location.href='$!{rc.contextPath}/stu/toEdit?id=$!{stu.stuId}&action=edit'">修改</a></li>
                    <li><a href="javascript:del($!{stu.stuId})">删除</a></li>
                  </ul>
                </div>
              </td>
            </tr>
        #end
        </tbody>
      </table>
    </div>
  </div>
  #page()
  #pageJs()
  #msgDlg()
  #myAjax()
</form>
  <script>
	function add(id){
		var data = myAjax('$!{rc.contextPath}/stu/del', false, 'json', {id : id});
		alert(1111+""+data);
  		if(myAjax('$!{rc.contextPath}/stu/del', false, 'json', {id : id}) == true){
  			open("友情提示", "删除成功", "$!{rc.contextPath}/stu/list");
    	}else{
          	open("友情提示", "删除失败", "$!{rc.contextPath}/stu/list");
    	}
  	}
	function del(id){
		$.ajax({
            type : 'post',
            url : '$!{rc.contextPath}/stu/del',
            data : {id : id},
            cache : false,
            dataType:'json',
            error : function (data) {
				##删除失败
            },
            success : function (data) {
          		if(data == true){
		    		open("友情提示", "删除成功", "$!{rc.contextPath}/stu/list");
		    	}else{
		    		open("友情提示", "删除失败", "$!{rc.contextPath}/stu/list");
		    	}
            }
    	});
  	}
  </script>
#end

#macro(class)
<div class="admin-content-body">
  <div class="am-cf am-padding">
    <div class="am-fl am-cf"><strong class="am-text-primary am-text-lg">Class Infomation</strong></div>
  </div>
  <div class="am-g">
    <div class="am-u-sm-12">
      <table class="am-table am-table-bd am-table-striped admin-content-table">
        <thead>
        <tr>
          <th>ClassId</th><th>ClassName</th><th>DeptName</th><th>Option</th>
        </tr>
        </thead>
        <tbody>
        #foreach($cls in $!{clazz})
            <tr>
        	  <td>$!{cls.classId}</td>
        	  <td>$!{cls.className}</td>
        	  <td>$!{cls.deptName}</td>
              <td>
                <div class="am-dropdown" data-am-dropdown>
                  <button class="am-btn am-btn-default am-btn-xs am-dropdown-toggle" data-am-dropdown-toggle><span class="am-icon-cog"></span> <span class="am-icon-caret-down"></span></button>
                  <ul class="am-dropdown-content">
                    <li><a href="#">修改</a></li>
                    <li><a href="#">删除</a></li>
                  </ul>
                </div>
              </td>
            </tr>
        #end
        </tbody>
      </table>
    </div>
  </div>
#end

#macro(dept)
<div class="admin-content-body">
  <div class="am-cf am-padding">
    <div class="am-fl am-cf"><strong class="am-text-primary am-text-lg">Student Infomatino</strong></div>
  </div>
  <div class="am-g">
    <div class="am-u-sm-12">
      <table class="am-table am-table-bd am-table-striped admin-content-table">
        <thead>
        <tr>
          <th>DeptId</th><th>DeptName</th><th>Option</th>
        </tr>
        </thead>
        <tbody>
        #foreach($dept in $!{depts.data})
            <tr>
        	  <td>$!{dept.deptId}</td>
        	  <td>$!{dept.deptName}</td>
              <td>
                <div class="am-dropdown" data-am-dropdown>
                  <button class="am-btn am-btn-default am-btn-xs am-dropdown-toggle" data-am-dropdown-toggle><span class="am-icon-cog"></span> <span class="am-icon-caret-down"></span></button>
                  <ul class="am-dropdown-content">
                    <li><a href="#">修改</a></li>
                    <li><a href="#">删除</a></li>
                  </ul>
                </div>
              </td>
            </tr>
        #end
        </tbody>
      </table>
    </div>
  </div>
#end

#macro(editStu)
<form #if($!{action} == 'edit') action="$!{rc.contextPath}/stu/edit" #else action="$!{rc.contextPath}/stu/add" #end class="am-form" data-am-validator style="width:800px;">
  <fieldset>
    <legend>#if($!{action} == 'edit') Edit Student Information #else Add Student #end</legend>
    <div class="am-form-group">
      <label for="doc-vld-name-2">StudentName</label>
      <input type="text" id="doc-vld-name-2" minlength="2" name="stuName" value="$!{student.stuName}" placeholder="Input student name(at least 2 characters)" required/>
    </div>

    <div class="am-form-group">
      <label for="doc-vld-name-2">Address</label>
      <input type="text" id="doc-vld-name-2" name="addr" value="$!{student.addr}" placeholder="Input an Address String" required/>
    </div>
    
    <div class="am-form-group">
      <label for="doc-vld-name-2">Dormitory</label>
      <input type="text" id="doc-vld-name-2" name="dormitory" value="$!{student.dormitory}" placeholder="dormitory" required/>
    </div>

	<div class="am-input-group am-datepicker-date" data-am-datepicker="{format: 'yyyy-mm-dd', viewMode: 'years'}">
	  <input type="text" class="am-form-field" name="birth" value="$!{student.birth}" placeholder="Select Birthday" readonly>
	  <span class="am-input-group-btn am-datepicker-add-on">
	    <button class="am-btn am-btn-default" type="button"><span class="am-icon-calendar"></span> </button>
	  </span>
	</div>

    <div class="am-form-group">
      <label for="doc-vld-age-2">Age</label>
      <input type="number" class="" name="age"  id="doc-vld-age-2" value="$!{student.age}" placeholder="Student Age  18-45" min="18" max="45" required />
    </div>

    <div class="am-form-group">
      <label for="doc-select-1">Gender</label>
      <select id="doc-select-1" name="gender" required>
        <option value="男" #if($!{student.gender} && $!{student.gender} == "男") selected #end>Male</option>
        <option value="女" #if($!{student.gender} && $!{student.gender} == "女") selected #end>Female</option>
      </select>
      <span class="am-form-caret"></span>
    </div>

	<div class="am-form-group">
      <label for="doc-select-1">Class</label>
      ##做一个循环取到班级值
	      <select id="doc-select-1" name="classId" required>
      	  <option value="">--Select Class--</option>
	      #foreach($cls in $!{class})
	        <option value="$!{cls.classId}">$!{cls.className}</option>
	      #end
	      </select>
      <span class="am-form-caret"></span>
    </div>

	<div class="am-form-group">
      <label for="doc-select-1">Dept</label>
      <select id="doc-select-1" name="deptId" required>
      	<option value="">--Select Dept--</option>
      	#foreach($dept in $!{depts})
        	<option value="$!{dept.deptId}">$!{dept.deptName}</option>
        #end
      </select>
      <span class="am-form-caret"></span>
    </div>

    <button class="am-btn am-btn-secondary" type="submit">#if($!{action} == 'edit') Save #else Add #end</button>
  </fieldset>
</form>
#end